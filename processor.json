{"files":[{"id":"49247f06-a77a-49d2-88ab-ba7d8e49240f","name":"dataManager","type":"server_js","source":"function driver(){\n  getData();\n  processData();\n  makeSlide();\n}\n\nfunction getData() {\n  var url \u003d \u0027https://my.api.mockaroo.com/isabel-large-response.json?key\u003de6ac1da0\u0027;\n  //calling the API\n  var response \u003d UrlFetchApp.fetch(url, {\u0027muteHttpExceptions\u0027: true});\n  var arrayResponse \u003d JSON.parse(response.getContentText());\n  \n  Logger.log(arrayResponse);\n  //preparing the data to be put in the spreadsheet\n  var dataarray \u003d new Array();\n  for (var i \u003d 0; i\u003carrayResponse.length; i++){\n    var thisRow \u003d new Array();\n    thisRow[0] \u003d arrayResponse[i].id;\n    thisRow[1] \u003d arrayResponse[i].import_country; \n    thisRow[2] \u003d arrayResponse[i].model;\n    thisRow[3] \u003d arrayResponse[i].make;\n    thisRow[4] \u003d arrayResponse[i].sold_by;\n    thisRow[5] \u003d arrayResponse[i].sale_price;\n    \n    dataarray[i] \u003d thisRow;\n  }\n  \n  //putting data in the spreadsheet\n  var datasheet \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Data\");\n  datasheet.clear();\n  datasheet.getRange(1, 1).setValue(\"ID\");\n  datasheet.getRange(1, 2).setValue(\"Import Country\");\n  datasheet.getRange(1, 3).setValue(\"Model\");\n  datasheet.getRange(1, 4).setValue(\"Make\");\n  datasheet.getRange(1, 5).setValue(\"Sold By\");\n  datasheet.getRange(1, 6).setValue(\"Sale Price\");\n  \n  for(var i \u003d 0; i\u003cdataarray.length; i++){\n    datasheet.getRange(i+2, 1).setValue(String(dataarray[i][0]));\n    datasheet.getRange(i+2, 2).setValue(String(dataarray[i][1]));\n    datasheet.getRange(i+2, 3).setValue(String(dataarray[i][2]));\n    datasheet.getRange(i+2, 4).setValue(String(dataarray[i][3]));\n    datasheet.getRange(i+2, 5).setValue(String(dataarray[i][4]));\n    datasheet.getRange(i+2, 6).setValue(String(dataarray[i][5]));\n  }\n}\n\nfunction processData(){\n  processCountries();\n  sortModels();\n  sortMakes();\n  sortSellers();\n  leastTargetedCountries();\n}\n\nfunction processCountries(){\n  var hashMap \u003d new Object();\n  var sales \u003d new Object();\n  var norepeat \u003d {};\n  var times \u003d {};\n  var countries \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Data\").getRange(2, 2, 1001, 1).getValues();\n  var salesData \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Data\").getRange(2, 6, 1001, 1).getValues();\n  var count \u003d 0;\n  \n  //initializing hash maps\n  for (var i \u003d 0; i \u003c countries.length; i++){\n    hashMap[countries[i].toString()] \u003d 0;\n    sales[countries[i].toString()] \u003d 0;\n  }\n  \n  //counting occurrences of countries\n  for (var i \u003d 0; i \u003c countries.length; i++){\n    if(hashMap[countries[i].toString()] \u003d\u003d 0){\n      norepeat[count] \u003d countries[i].toString();\n      count ++;\n    }\n    hashMap[countries[i].toString()]++;\n    sales[countries[i].toString()] +\u003d parseInt(salesData[i]);\n    \n    \n  }\n  \n  var sheet \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Processed\");\n  for (var k \u003d 0; k \u003c count-1; k++){\n    sheet.getRange(k+2, 7).setValue(norepeat[k]);\n    sheet.getRange(k+2, 8).setValue(hashMap[norepeat[k]]);\n    sheet.getRange(k+2, 9).setValue(sales[norepeat[k]]);\n  }\n  \n  sheet.getRange(2, 7, 1000, 3).sort({column: 9, ascending: false});\n}\n\nfunction sortModels(){\n  var hashMap \u003d new Object();\n  var norepeat \u003d {};\n  var times \u003d {};\n  var models \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Data\").getRange(2, 3, 1001, 1).getValues();\n  var count \u003d 0;\n  \n  //initializing hash map\n  for (var i \u003d 0; i \u003c models.length; i++){\n    hashMap[models[i].toString()] \u003d 0;\n  }\n  \n  //counting occurrences of models\n  for (var i \u003d 0; i \u003c models.length; i++){\n    if(models[i].toString() !\u003d \"undefined\"){\n      if(hashMap[models[i].toString()] \u003d\u003d 0){\n        norepeat[count] \u003d models[i].toString();\n        count ++;\n      }\n      hashMap[models[i].toString()]++;\n    }\n  }\n  \n  var sheet \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Processed\");\n  for (var k \u003d 0; k \u003c count-1; k++){\n    sheet.getRange(k+2, 1).setValue(norepeat[k]);\n    sheet.getRange(k+2, 2).setValue(hashMap[norepeat[k]]);\n  }\n  \n  sheet.getRange(2, 1, 1000, 2).sort({column: 2, ascending: false});\n}\n\nfunction sortMakes(){\n  var hashMap \u003d new Object();\n  var norepeat \u003d {};\n  var times \u003d {};\n  var makes \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Data\").getRange(2, 4, 1001, 1).getValues();\n  var count \u003d 0;\n  \n  //initializing hash map\n  for (var i \u003d 0; i \u003c makes.length; i++){\n    hashMap[makes[i].toString()] \u003d 0;\n  }\n  \n  //counting occurrences of makes\n  for (var i \u003d 0; i \u003c makes.length; i++){\n    if(makes[i].toString() !\u003d \"undefined\"){\n      if(hashMap[makes[i].toString()] \u003d\u003d 0){\n        norepeat[count] \u003d makes[i].toString();\n        count ++;\n      }\n      hashMap[makes[i].toString()]++;\n    }\n  }\n  \n  var sheet \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Processed\");\n  for (var k \u003d 0; k \u003c count-1; k++){\n    sheet.getRange(k+2, 4).setValue(norepeat[k]);\n    sheet.getRange(k+2, 5).setValue(hashMap[norepeat[k]]);\n  }\n  \n  sheet.getRange(2, 4, 1000, 2).sort({column: 5, ascending: false});\n}\n\nfunction sortSellers(){\n  var hashMap \u003d new Object();\n  var norepeat \u003d {};\n  var times \u003d {};\n  var sellers \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Data\").getRange(2, 5, 1001, 1).getValues();\n  var salesData \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Data\").getRange(2, 6, 1001, 1).getValues();\n  var count \u003d 0;\n  \n  //initializing hash map\n  for (var i \u003d 0; i \u003c sellers.length; i++){\n    hashMap[sellers[i].toString()] \u003d 0;\n  }\n  \n  //counting occurrences of countries\n  for (var i \u003d 0; i \u003c sellers.length; i++){\n    if(hashMap[sellers[i].toString()] \u003d\u003d 0){\n      norepeat[count] \u003d sellers[i].toString();\n      count ++;\n    }\n    hashMap[sellers[i].toString()] +\u003d parseInt(salesData[i]);\n  }\n  \n  var sheet \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Processed\");\n  for (var k \u003d 0; k \u003c count-1; k++){\n    sheet.getRange(k+2, 11).setValue(norepeat[k]);\n    sheet.getRange(k+2, 12).setValue(hashMap[norepeat[k]]);\n  }\n  \n  sheet.getRange(2, 11, 1000, 2).sort({column: 12, ascending: false});\n}\n\nfunction leastTargetedCountries(){\n  var sheet \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Processed\");\n  var occurrences \u003d sheet.getRange(2, 8, 1000).getValues();\n  //finding min\n  var minCountries \u003d {};\n  var count \u003d 0;\n  var currMin \u003d 1000000;\n  for (var i \u003d 0; i \u003c occurrences.length; i++){\n    if(parseInt(occurrences[i]) \u003c currMin){\n      currMin \u003d occurrences[i];\n    }\n  }\n  for (var j \u003d 0; j \u003c occurrences.length; j++){\n    if(parseInt(occurrences[j]) \u003d\u003d currMin){\n      minCountries[count] \u003d j;\n      count++;\n    }\n  }\n  for(var k \u003d 0; k \u003ccount; k++){\n    //sheet.getRange(k+1, 19).setValue(occurrences[minCountries[k]]);\n    sheet.getRange(k+1, 19).setValue(sheet.getRange(minCountries[k], 7).getValue());\n    \n    sheet.getRange(k+1, 20).setValue(currMin);\n  }\n}\n\nfunction makeSlide() {\n  var name \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Processed\").getRange(2, 11).getValue().toString();\n  var sale \u003d SpreadsheetApp.openById(\"1KFbVpqHaUv3EsNaFXK9dpm_hiKs835Wp_mt57YZvlu0\").getSheetByName(\"Processed\").getRange(2, 12).getValue().toString();\n  \n  var slides \u003d SlidesApp.openById(\"1njNXGvwa-V9Db64tjipFIfDDgF1fFwxw-bhp0snAkYg\").getSlides();\n  var myslide \u003d slides[0];\n  var myshape \u003d myslide.getShapes()[0];\n  myshape.getText().setText(\"Todayâ€™s Top Seller is \" + name + \" with a total sold of $\" + sale );\n  \n}\n"},{"id":"52d3c5f9-03c3-407f-a5f1-8edb58e4e792","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/New_York\",\n  \"dependencies\": {\n    \"enabledAdvancedServices\": [{\n      \"userSymbol\": \"Drive\",\n      \"serviceId\": \"drive\",\n      \"version\": \"v2\"\n    }]\n  },\n  \"exceptionLogging\": \"STACKDRIVER\"\n}"}]}